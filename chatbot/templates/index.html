{% extends 'nav.html' %}
{% block content %}
{% load staticfiles %}
<div class="modal fade" id="responseBigAvatar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body" style="text-align: center;">
          <img src="{% static 'img/me.jpg' %}" class="avatar-modal">
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="bigAvatar" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: ">
    <div class="modal-content">
      <div class="modal-body" style="text-align: center;">
            {% if current_user.is_authenticated %}
                <img src="{{ current_user.avatar.avatar.url }}" class="avatar-modal">
            {% else %}
                <img src="{% static 'img/default.png' %}" class="avatar-modal">
            {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="container">

    <div class="row">
        <div class="col-md-12">
            <ul class="nav nav-tabs nav-fill" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" role="tab" data-toggle="tab"
                       href="#chat" id="chat-tab" aria-controls="chat" aria-selected="true">å¯¹è¯ç³»ç»Ÿ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" role="tab" data-toggle="tab"
                       href="#separation" id="separation-tab" aria-controls="separation">åˆ†è¯å·¥å…·</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" role="tab" data-toggle="tab"
                       href="#synonym" id="synonym-tab" aria-controls="synonym">è¿‘ä¹‰è¯åˆ¤æ–­</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" role="tab" data-toggle="tab"
                       href="#sentiment" id="sentiment-tab" aria-controls="sentiment">æƒ…æ„Ÿåˆ¤æ–­</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">&nbsp;</div>
        <div class="tab-content col-md-6" id="navContent">
            <!-- èŠå¤©ç•Œé¢ -->
            <div class="tab-pane fade show active" id="chat" role="tabpanel" aria-labelledby="chat-tab">
                <!-- å¯¹è¯åˆ—è¡¨ -->

                <div id="chat-box">
                    {% for item in history %}
                        {% if item.is_response %}
                            <div class="chat-item">
                                <div class="avatar2">
                                    <img data-toggle="modal" data-target="#responseBigAvatar"
                                         src="{% static 'img/me.jpg' %}" class="avatar-img">
                                </div>
                                <div class="message2">
                                    {{ item.text|safe }}
                                </div>
                            </div>
                        {% else %}
                            <div class="chat-item">
                                <div class="avatar1">
                                    <img data-toggle="modal" data-target="#bigAvatar"
                                         src="{{ current_user.avatar.avatar.url }}" class="avatar-img">
                                </div>
                                <div class="message1">
                                    {{ item.text }}
                                </div>
                                <div class="emoji">
                                    {% if item.emotion < 0 %}

                                    {% elif item.emotion >= 0 and item.emotion < 0.25 %}
                                        ğŸ˜
                                    {% elif item.emotion < 0.5 %}
                                        ğŸ˜‘
                                    {% elif item.emotion < 0.75 %}
                                        ğŸ™‚
                                    {% elif item.emotion <= 1 %}
                                        ğŸ˜„
                                    {% else %}

                                    {% endif %}
                                </div>
                            </div>

                        {% endif %}
                    {% endfor %}
                </div>
                <!-- è¾“å…¥æ¡† -->
                <div style="padding-top: 20px">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="èŠç‚¹ä»€ä¹ˆå§" aria-label="Text"
                               aria-describedby="send" id="input-box">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="send-button"
                                    onclick="sendMessage()">å‘é€
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- åˆ†è¯ -->
            <div class="tab-pane fade" id="separation" role="tabpanel" aria-labelledby="separation-tab">
                <form>
                    <div class="form-group form">
                        <label for="to-separation">è¯·è¾“å…¥å¥å­</label>
                        <textarea class="form-control" id="to-separation" rows="3">ç¿»è¯‘è…”æ˜¯æŒ‡ç¿»è¯‘å‡ºæ¥çš„è¯‘æ–‡æœ‰æ´‹åŒ–ç°è±¡æˆ–ä¸ç¬¦åˆæ±‰è¯­ä¹ æƒ¯çš„è¡¨è¾¾æ–¹å¼ã€‚è¡¨ç°ä¸ºè¯‘æ–‡ä¸è‡ªç„¶ã€ä¸æµç•…ã€ç”Ÿç¡¬ã€éš¾æ‡‚ã€è´¹è§£ç­‰ç‰¹ç‚¹ã€‚</textarea>
                    </div>
                    <button class="btn btn-primary" type="button" onclick="separation()">ç¡®å®š</button>
                </form>
            </div>
            <div class="tab-pane fade" id="synonym" role="tabpanel" aria-labelledby="synonym-tab">
                <h5>è¯·è¾“å…¥ä¸¤ä¸ªè¯</h5>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" aria-label="Text"
                           aria-describedby="send" id="synonym-box-1">
                    &nbsp;
                    <input type="text" class="form-control" aria-label="Text"
                           aria-describedby="send" id="synonym-box-2">
                </div>
                <div>ç»“æœï¼š</div>
                <div id="synonym-result"></div>
                <button class="btn btn-primary" type="button" onclick="synonym()">ç¡®å®š</button>
            </div>
            <div class="tab-pane fade" id="sentiment" role="tabpanel" aria-labelledby="sentiment-tab">
                <form>
                    <div class="form-group form">
                        <label for="to-sentiment">è¯·è¾“å…¥å¥å­</label>
                        <textarea class="form-control" id="to-sentiment" rows="3"></textarea>
                    </div>
                    <div>ç»“æœï¼ˆæ•°å€¼è¶Šå¤§è¡¨ç¤ºå¥å­ç§¯æç¨‹åº¦è¶Šé«˜ï¼‰ï¼š</div>
                    <div id="sentiment-result"></div>
                    <button class="btn btn-primary" type="button" onclick="sentiment()">ç¡®å®š</button>
                </form>
            </div>
        </div>
    </div>
</div>
<div id="response-template" style="display: none;">
    <div class="avatar2">
        <img data-toggle="modal" data-target="#responseBigAvatar"
             src="{% static 'img/me.jpg' %}" class="avatar-img">
    </div>
</div>
<div id="say-template" style="display: none;">
    <div class="avatar1">
        {% if current_user.is_authenticated %}
        <img data-toggle="modal" data-target="#bigAvatar" src="{{ current_user.avatar.avatar.url }}" class="avatar-img">
        {% else %}
        <img data-toggle="modal" data-target="#bigAvatar" src="{% static 'img/default.png' %}" class="avatar-img">
        {% endif %}
    </div>
</div>
{% csrf_token %}
{% endblock %}